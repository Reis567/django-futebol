{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container">
    <!-- Nome do time com destaque -->
    <div class="text-center mb-4">
        <h1 class="display-4 font-weight-bold">{{ time.nome }}</h1>
    </div>
    
    <div class="row">
        <!-- Coluna dos Jogadores Titulares -->
        <div class="col-md-6 text-center">
            <h3 class="font-weight-bold mb-4">Jogadores Titulares</h3>
            <ul id="titulares" class="list-group list-group-flush jogadores-list" ondrop="handleDrop(event)" ondragover="allowDrop(event)">
                {% for jogador in jogadores_titulares %}
                    <li class="list-group-item jogador-item" draggable="true" ondragstart="handleDragStart(event)" data-id="{{ jogador.id }}">
                        {{ jogador.nome }} ({{ jogador.numero_camisa }} - {{ jogador.get_posicao_display }})
                    </li>
                {% empty %}
                    <li class="list-group-item">Nenhum jogador titular.</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Coluna dos Jogadores do Banco -->
        <div class="col-md-6 text-center">
            <h3 class="font-weight-bold mb-4">Jogadores no Banco</h3>
            <ul id="banco" class="list-group list-group-flush jogadores-list" ondrop="handleDrop(event)" ondragover="allowDrop(event)">
                {% for jogador in jogadores_banco %}
                    <li class="list-group-item jogador-item" draggable="true" ondragstart="handleDragStart(event)" data-id="{{ jogador.id }}">
                        {{ jogador.nome }} ({{ jogador.numero_camisa }} - {{ jogador.get_posicao_display }})
                    </li>
                {% empty %}
                    <li class="list-group-item">Nenhum jogador no banco.</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

<style>
    /* Estilo da área de gerenciamento do time */
    .container {
        margin-top: 30px;
    }
    
    .display-4 {
        font-size: 4rem;
/* Cor mais escura para o nome do time */
    }

    .font-weight-bold {
        font-weight: bold;
    }

    /* Estilo das listas de jogadores */
    .jogadores-list {
        min-height: 250px;
        border: 2px solid ; /* Borda azul */
        padding: 15px;
        background-color: #f1f1f1;
    }
    
    .jogador-item {
        cursor: move;
        margin-bottom: 10px;
        font-size: 16px;
        font-weight: 500;
        background-color: #e9ecef;
        border: 1px solid ;
    }

    /* Centralizar os títulos das seções de jogadores */
    h3 {
        text-transform: uppercase;
    }
</style>

<script>
    function handleDragStart(event) {
        event.dataTransfer.setData('text/plain', event.target.dataset.id);
    }

    function allowDrop(event) {
        event.preventDefault();
    }

    function handleDrop(event) {
        event.preventDefault();
        const jogadorId = event.dataTransfer.getData('text/plain');
        const novaPosicao = event.target.closest('.jogadores-list').id;  // 'titulares' ou 'banco'
        
        // Atualizar a UI
        const jogadorElement = document.querySelector(`[data-id="${jogadorId}"]`);
        event.target.appendChild(jogadorElement);

        // Enviar a alteração para o servidor
        fetch(`{% url 'atualizar_jogadores' time.id %}`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: new URLSearchParams({
                'jogador_id': jogadorId,
                'nova_posicao': nova_posicao
            })
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
        })
        .catch(error => {
            console.error('Erro:', error);
        });
    }
</script>
{% endblock %}
