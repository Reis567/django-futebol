{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container">
    <h2>Gerenciar Time: {{ time.nome }}</h2>
    
    <div class="row">
        <!-- Coluna dos Jogadores Titulares -->
        <div class="col-md-6">
            <h4>Jogadores Titulares</h4>
            <ul id="titulares" class="list-group list-group-flush jogadores-list" ondrop="handleDrop(event)" ondragover="allowDrop(event)">
                {% for jogador in jogadores_titulares %}
                    <li class="list-group-item jogador-item" draggable="true" ondragstart="handleDragStart(event)" data-id="{{ jogador.id }}">
                        {{ jogador.nome }} ({{ jogador.numero_camisa }} - {{ jogador.get_posicao_display }})
                    </li>
                {% empty %}
                    <li class="list-group-item">Nenhum jogador titular.</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Coluna dos Jogadores do Banco -->
        <div class="col-md-6">
            <h4>Jogadores no Banco</h4>
            <ul id="banco" class="list-group list-group-flush jogadores-list" ondrop="handleDrop(event)" ondragover="allowDrop(event)">
                {% for jogador in jogadores_banco %}
                    <li class="list-group-item jogador-item" draggable="true" ondragstart="handleDragStart(event)" data-id="{{ jogador.id }}">
                        {{ jogador.nome }} ({{ jogador.numero_camisa }} - {{ jogador.get_posicao_display }})
                    </li>
                {% empty %}
                    <li class="list-group-item">Nenhum jogador no banco.</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

<style>
    .jogadores-list {
        min-height: 200px;
        border: 1px solid #ccc;
        padding: 10px;
        background-color: #f8f9fa;
    }
    .jogador-item {
        cursor: move;
        margin-bottom: 5px;
    }
</style>

<script>
    function handleDragStart(event) {
        event.dataTransfer.setData('text/plain', event.target.dataset.id);
    }

    function allowDrop(event) {
        event.preventDefault();
    }

    function handleDrop(event) {
        event.preventDefault();
        const jogadorId = event.dataTransfer.getData('text/plain');
        const novaPosicao = event.target.closest('.jogadores-list').id;  // 'titulares' ou 'banco'
        
        // Atualizar a UI
        const jogadorElement = document.querySelector(`[data-id="${jogadorId}"]`);
        event.target.appendChild(jogadorElement);

        // Enviar a alteração para o servidor
        fetch(`{% url 'atualizar_jogadores' time.id %}`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: new URLSearchParams({
                'jogador_id': jogadorId,
                'nova_posicao': novaPosicao
            })
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
        })
        .catch(error => {
            console.error('Erro:', error);
        });
    }
</script>
{% endblock %}
